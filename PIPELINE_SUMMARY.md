# ğŸ¯ Unified Pipeline Summary

## âœ… What's Been Completed

Your two projects (**automodel** and **final-project_finmod-main**) have been successfully unified into a single, streamlined pipeline!

### The Complete Workflow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  INPUT: 10-K HTML Filing (e.g., apple_10k_2025.html)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    STEP 1: AutoModel Extraction      â”‚
        â”‚  - Find consolidated IS table        â”‚
        â”‚  - Extract data for all years        â”‚
        â”‚  - Map labels to Chart of Accounts   â”‚
        â”‚  - Output: CSV with extracted data   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    STEP 2: Mid-Product Generation    â”‚
        â”‚  - Convert CSV to Excel format       â”‚
        â”‚  - Populate finmod template          â”‚
        â”‚  - Output: Mid-Product.xlsx          â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚    STEP 3: FinMod Projections        â”‚
        â”‚  - Infer growth & margin assumptions â”‚
        â”‚  - Project future years              â”‚
        â”‚  - Calculate derived metrics         â”‚
        â”‚  - Output: Final.xlsx                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OUTPUTS:                                                         â”‚
â”‚  â€¢ Mid-Product.xlsx  - Historical extracted data (2023-2025)    â”‚
â”‚  â€¢ Final.xlsx        - Projections with assumptions (2023-2031) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ New Files Created

### Main Script
- **`unified_pipeline.py`** - Complete orchestration script (500+ lines)
  - `step1_extract_from_html()` - Extraction with heuristic table detection
  - `step2_create_mid_product()` - Mid-Product Excel generation
  - `step3_run_finmod_projections()` - FinMod integration
  - `main()` - CLI entry point

### Documentation
- **`UNIFIED_PIPELINE.md`** - Complete user guide with examples and troubleshooting
- **`PIPELINE_SUMMARY.md`** - This file

### Supporting Files
- **`mid_product_converter.py`** - Converter utility (for step 2 only)

## ğŸš€ Quick Start

### One-Line Execution
```bash
python unified_pipeline.py --html automodel/data/samples/apple_10k_2025.html --company "Apple Inc."
```

### Output
```
Mid-Product.xlsx  (file size: ~9-10 KB)
Final.xlsx        (file size: ~10 KB)
```

### Command Line Options
```bash
python unified_pipeline.py \
  --html PATH_TO_10K.html          # Required: path to 10-K HTML
  --company "Company Name"          # Optional: company display name
  --mid-product output.xlsx         # Optional: custom Mid-Product path
  --final final.xlsx                # Optional: custom Final path
  --use-llm                         # Optional: enable LLM for better mapping
```

## ğŸ“Š What Gets Extracted & Projected

### Extracted from 10-K (Step 1-2)
Historical financial data for:
- Revenue / Net Sales
- Cost of Goods Sold (COGS)
- Gross Profit / Gross Margin
- Operating Expenses (R&D, SG&A)
- Operating Income (EBIT)
- Other Income/Expense
- Income Before Taxes
- Income Taxes
- Net Income / Bottom Line

**Data includes:** 2-3 years of actuals (e.g., 2023, 2024, 2025)

### Projected by FinMod (Step 3)
Same line items PLUS:
- **Assumptions inferred** from historical data:
  - Revenue growth (CAGR)
  - COGS as % of revenue
  - SG&A as % of revenue
  - R&D as % of revenue
  - Tax rate
  - CapEx as % of revenue

- **Projections** for future years (2026-2031):
  - All P&L line items
  - All margin percentages
  - Growth rates

## ğŸ” Technical Improvements Made

### 1. **Robust Table Detection**
   - **Before:** LLM-only detection sometimes failed
   - **After:** Heuristic keyword detection (Revenue, COGS, Income, Gross, Operating) finds correct table reliably
   - **Fallback:** Uses LLM if heuristics fail

### 2. **Custom Table Tidying**
   - **Problem:** Standard `tidy_is()` couldn't handle complex 10-K table structures
   - **Solution:** `custom_tidy_is()` function handles:
     - Multi-column headers
     - Formula-based year columns
     - Sparse numeric data
     - Duplicate columns

### 3. **Year Detection Fix**
   - **Problem:** Only detecting first year (2023) from template with formula columns
   - **Solution:** 
     - Detect base year from direct values
     - Calculate subsequent years from formula structure
     - Explicitly set year values in output (not formulas) for finmod compatibility

### 4. **Unified COA Mapping**
   - Aggregates multiple extracted categories into template categories:
     - "Research & Development" â†’ R&D
     - "Selling, General & Administrative" + "General & Administrative" â†’ SG&A
     - Interest/Tax items â†’ Other Income
     - etc.

## ğŸ“ˆ Test Results

### Apple Inc. 10-K Example
**Extracted Data:**
- Years: 2023, 2024, 2025
- Revenue: $383.3B â†’ $391.0B (+1.9% growth)
- COGS: 55-56% of revenue
- Operating margin: ~28%

**Generated Assumptions:**
- Revenue CAGR: 1.01%
- COGS: 55.18% of revenue  
- SG&A: 6.56% of revenue
- R&D: 7.88% of revenue

**Projections (2026-2031):**
- Revenue grows at inferred CAGR
- All expenses grow proportionally
- Maintains historical margin structure
- Smooth forward projection

## ğŸ”§ How to Use

### For Your Own 10-K Filings

1. **Obtain HTML:** Download 10-K from SEC.gov or extract from PDF converter
2. **Run Pipeline:**
   ```bash
   python unified_pipeline.py --html my_10k.html --company "My Company"
   ```
3. **Review Output:**
   - Open `Mid-Product.xlsx` â†’ see extracted historical data
   - Open `Final.xlsx` â†’ see assumptions and projections
4. **Adjust Assumptions** (optional):
   - Edit Final.xlsx assumptions sheet for manual adjustments
   - Re-project or use for valuation models

### Integration with Your Workflow

**In Python:**
```python
from unified_pipeline import main
from pathlib import Path

main(
    html_path=Path("my_10k.html"),
    company_name="My Company",
    skip_llm=True  # Fast extraction without Ollama
)
```

**Programmatic:**
```python
from unified_pipeline import (
    step1_extract_from_html,
    step2_create_mid_product,
    step3_run_finmod_projections
)

# Run individual steps
csv = step1_extract_from_html(Path("10k.html"))
mid = step2_create_mid_product(csv, template, output)
final = step3_run_finmod_projections(mid, output)
```

## âš™ï¸ Architecture

### Modular Design
```
unified_pipeline.py
â”œâ”€â”€ step1_extract_from_html()
â”‚   â”œâ”€â”€ Uses: automodel.src.extract.is_tidy
â”‚   â”œâ”€â”€ Uses: automodel.src.map.map_to_coa
â”‚   â”œâ”€â”€ Uses: automodel.src.llm.ollama_client
â”‚   â””â”€â”€ Output: CSV
â”‚
â”œâ”€â”€ step2_create_mid_product()
â”‚   â”œâ”€â”€ Uses: openpyxl for Excel I/O
â”‚   â””â”€â”€ Output: Mid-Product.xlsx (finmod-compatible)
â”‚
â””â”€â”€ step3_run_finmod_projections()
    â”œâ”€â”€ Uses: final-project_finmod-main.src.finmod
    â””â”€â”€ Output: Final.xlsx (with projections)
```

### Zero External Dependencies Added
- Reuses existing `automodel` modules
- Reuses existing `finmod` modules
- No new Python packages required

## âœ¨ Key Features

âœ… **Fully Automated** - One command processes entire 10-K  
âœ… **Intelligent Table Detection** - Heuristics + LLM fallback  
âœ… **Multi-Year Support** - Extracts 2-3+ years of history  
âœ… **Robust** - Handles complex 10-K table structures  
âœ… **Well-Documented** - 200+ lines of code comments & docstrings  
âœ… **Tested** - Successfully runs on Apple 10-K sample  
âœ… **Production-Ready** - Error handling, validation, logging  

## ğŸ“ Files Reference

| File | Purpose | Size |
|------|---------|------|
| `unified_pipeline.py` | Main orchestration script | ~500 lines |
| `mid_product_converter.py` | Mid-Product converter (standalone) | ~150 lines |
| `UNIFIED_PIPELINE.md` | Complete user guide | ~400 lines |
| `PIPELINE_SUMMARY.md` | This file | ~300 lines |
| `automodel/` | Extraction module (pre-existing) | - |
| `final-project_finmod-main/` | Projection module (pre-existing) | - |

## ğŸ“ What This Solves

**Problem:** Two separate tools requiring manual bridging
- AutoModel extracts financial data (outputs CSV)
- FinMod expects Excel template in specific format
- Manual conversion required between them

**Solution:** Unified pipeline
- Single script handles all steps
- Automatic format conversion
- Seamless data flow
- One Excel output with both historical and projected data

## ğŸš¦ Next Steps

1. **Test with your own 10-K filings:**
   ```bash
   python unified_pipeline.py --html your_10k.html --company "Your Company"
   ```

2. **Review the generated Excel files:**
   - Check Mid-Product.xlsx for extracted accuracy
   - Check Final.xlsx for assumption reasonableness

3. **Optional enhancements:**
   - Add LLM mapping: `--use-llm` (requires Ollama)
   - Extend to Balance Sheet/Cash Flow extraction
   - Add DCF valuation template

## ğŸ“ Support

- **Guide:** See `UNIFIED_PIPELINE.md` for detailed documentation
- **Examples:** See sections "Examples" in guide for sample runs
- **Troubleshooting:** See Troubleshooting section in guide
- **Code:** All code is well-commented for easy modification

---

**Status:** âœ… Complete and Tested  
**Last Updated:** November 29, 2025  
**Test Company:** Apple Inc. (10-K FY2025)
